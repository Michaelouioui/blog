# 性能优化琐碎事

> 注意：该知识点属于性能优化领域。

总的来说性能优化这个领域的很多内容都很**碎片化**，这一章节我们将来学习这些碎片化的内容。

## 图片优化

### 计算图片大小

对于一张 100 * 100 像素的图片来说，图像上有 10000 个像素点，如果每个像素的值是 **RGBA** 存储的话，那么也就是说每个像素有 4 个通道，每个通道 1 个字节（8 位 = 1个字节），所以该图片大小大概为 39KB（10000 * 1 * 4 / 1024）。

但是在实际项目中，一张图片可能并不需要使用那么多颜色去显示，我们可以通过减少每个像素的调色板来相应缩小图片的大小。

了解了如何计算图片大小的知识，那么对于如何优化图片，想必大家已经有 2 个思路了：

- **减少像素点**
- **减少每个像素点能够显示的颜色**

### 图片加载优化

1. 不用图片。很多时候会使用到很多修饰类图片，其实这类修饰图片完全可以用 CSS 去代替。
2. 对于移动端来说，屏幕宽度就那么点，完全没有必要去加载原图浪费带宽。一般图片都用 CDN 加载，可以计算出适配屏幕的宽度，然后去请求相应裁剪好的图片。
3. 小图使用 base64 格式
4. 将多个图标文件整合到一张图片中（雪碧图）
5. 选择正确的图片格式：
   - 对于能够显示 WebP 格式的浏览器尽量使用 WebP 格式。因为 WebP 格式具有更好的图像数据压缩算法，能带来更小的图片体积，而且拥有肉眼识别无差异的图像质量，缺点就是兼容性并不好
   - 小图使用 PNG，其实对于大部分图标这类图片，完全可以使用 SVG 代替
   - 照片使用 JPEG

## DNS 预解析

DNS 解析也是需要时间的，可以通过预解析的方式来预先获得域名所对应的 IP。

```
<link rel="dns-prefetch" href="//yuchengkai.cn">
```

## 节流

考虑一个场景，滚动事件中会发起网络请求，但是我们并不希望用户在滚动过程中一直发起请求，而是隔一段时间发起一次，对于这种情况我们就可以使用节流。

理解了节流的用途，我们就来实现下这个函数

```
// func是用户传入需要防抖的函数
// wait是等待时间
const throttle = (func, wait = 50) => {
  // 上一次执行该函数的时间
  let lastTime = 0
  return function(...args) {
    // 当前时间
    let now = +new Date()
    // 将当前时间和上一次执行函数时间对比
    // 如果差值大于设置的等待时间就执行函数
    if (now - lastTime > wait) {
      lastTime = now
      func.apply(this, args)
    }
  }
}

setInterval(
  throttle(() => {
    console.log(1)
  }, 500),
  1
)
```

## 防抖

考虑一个场景，有一个按钮点击会触发网络请求，但是我们并不希望每次点击都发起网络请求，而是当用户点击按钮一段时间后没有再次点击的情况才去发起网络请求，对于这种情况我们就可以使用防抖。

理解了防抖的用途，我们就来实现下这个函数

```
// func是用户传入需要防抖的函数
// wait是等待时间
const debounce = (func, wait = 50) => {
  // 缓存一个定时器id
  let timer = 0
  // 这里返回的函数是每次用户实际调用的防抖函数
  // 如果已经设定过定时器了就清空上一次的定时器
  // 开始一个新的定时器，延迟执行用户传入的方法
  return function(...args) {
    if (timer) clearTimeout(timer)
    timer = setTimeout(() => {
      func.apply(this, args)
    }, wait)
  }
}
```

## 预加载

在开发中，可能会遇到这样的情况。有些资源不需要马上用到，但是希望尽早获取，这时候就可以使用预加载。

预加载其实是声明式的 `fetch` ，强制浏览器请求资源，并且不会阻塞 `onload` 事件，可以使用以下代码开启预加载

```
<link rel="preload" href="http://example.com">
```

预加载可以一定程度上降低首屏的加载时间，因为可以将一些不影响首屏但重要的文件延后加载，唯一缺点就是兼容性不好。

## 预渲染

可以通过预渲染将下载的文件预先在后台渲染，可以使用以下代码开启预渲染

```
<link rel="prerender" href="http://example.com"> 
```

预渲染虽然可以提高页面的加载速度，但是要确保该页面大概率会被用户在之后打开，否则就是白白浪费资源去渲染。

## 懒执行

懒执行就是将某些逻辑延迟到使用时再计算。该技术可以用于首屏优化，对于某些耗时逻辑并不需要在首屏就使用的，就可以使用懒执行。懒执行需要唤醒，一般可以通过定时器或者事件的调用来唤醒。

## 懒加载

懒加载就是将不关键的资源延后加载。

懒加载的原理就是只加载自定义区域（通常是可视区域，但也可以是即将进入可视区域）内需要加载的东西。对于图片来说，先设置图片标签的 `src` 属性为一张占位图，将真实的图片资源放入一个自定义属性中，当进入自定义区域时，就将自定义属性替换为 `src` 属性，这样图片就会去下载资源，实现了图片懒加载。

懒加载不仅可以用于图片，也可以使用在别的资源上。比如进入可视区域才开始播放视频等等。

## CDN

CDN 的原理是尽可能的在各个地方分布机房缓存数据，这样即使我们的根服务器远在国外，在国内的用户也可以通过国内的机房迅速加载资源。

因此，我们可以将静态资源尽量使用 CDN 加载，由于浏览器对于单个域名有并发请求上限，可以考虑使用多个 CDN 域名。并且对于 CDN 加载静态资源需要注意 CDN 域名要与主站不同，否则每次请求都会带上主站的 Cookie，平白消耗流量。

## 小结

这些碎片化的性能优化点看似很短，但是却能在出现性能问题时简单高效的提高性能，并且好几个点都是面试高频考点，比如节流、防抖。如果你还没有在项目中使用过这些技术，可以尝试着用到项目中，体验下功效。

留言

![img](https://p9-passport.byteacctimg.com/img/user-avatar/5e41ee1c076d80557fa78839ed4c71c7~300x300.image)

发表评论

全部评论（35）

[![nojsja的头像](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/3298190612015405)

[nojsja![lv-2](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/f597b88d22ce5370bd94495780459040.svg)](https://juejin.cn/user/3298190612015405)

web developer @ ԅ(¯㉨¯ԅ)1月前

有点水，大部分的文章都。。。

点赞

回复

[![idoi的头像](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/2999123452102222)

[idoi](https://juejin.cn/user/2999123452102222)

前端工程师 @ 字节跳动1年前

元素的 rel 属性的属性值preload能够让你在你的HTML页面中 元素内部书写一些声明式的资源获取请求，可以指明哪些资源是在页面加载完成后即刻需要的。对于这种即刻需要的资源，你可能希望在页面加载的生命周期的早期阶段就开始获取，在浏览器的主渲染机制介入前就进行预加载。这一机制使得资源可以更早的得到加载并可用，且更不易阻塞页面的初步渲染，进而提升性能

1

回复

[![僵尸鱼的头像](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/272334611566350)

[僵尸鱼![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/272334611566350)

前端开发2年前

我觉的preload表达的有点不好，preload用来指定页面加载后很快会被用到的资源。对于这种即刻需要的资源，你可能希望在页面加载的生命周期的早期阶段就开始获取，在浏览器的主渲染机制介入前就进行预加载。这一机制使得资源可以更早的得到加载并可用，且更不易阻塞页面的初步渲染，进而提升性能（摘自MDN）

4

2

[![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/2770425030652462)

[前端古力士![lv-3](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/e108c685147dfe1fb03d4a37257fb417.svg)](https://juejin.cn/user/2770425030652462)

2年前

我读到这部分的时候也是感到疑惑，预加载应该就是把希望早点用到的资源提前加载进来，以便使用，文章用写的是延后加载，让我感到困惑。

点赞

回复

[![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/3104676566801374)

[是你的益达](https://juejin.cn/user/3104676566801374)

1年前

后面这里感觉作者有点心不在焉了

1

回复

[![Kisetsu的头像](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/4248168660476941)

[Kisetsu](https://juejin.cn/user/4248168660476941)

前端鸡太美 @ Yoga3年前

箭头函数

点赞

回复

[![zerosrat的头像](https://p9-passport.byteacctimg.com/img/mosaic-legacy/3792/5112637127~300x300.image)](https://juejin.cn/user/1538972006230942)

[zerosrat](https://juejin.cn/user/1538972006230942)

3年前

函数防抖与函数节流 by 司徒正美

2

2

[![img](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/mirror-assets/168e0952b89ce4c233c~tplv-t2oaga2asx-no-mark:24:24:24:24.awebp)](https://juejin.cn/user/114004940315838)

[L-杰祥](https://juejin.cn/user/114004940315838)

3年前

老子看到司徒正美就想打人，开发个avalon就牛逼到天了。不过确实牛逼

点赞

回复

[![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/1802854798998839)

[Lim_Guo](https://juejin.cn/user/1802854798998839)

1年前

有的人即使不在这个世上了，但是他所留下的遗产却能让人获益

1

回复

[![蒙面大虾的头像](https://p3-passport.byteacctimg.com/img/user-avatar/24e34b949c10b91b35acf1e252bd84ed~300x300.image)](https://juejin.cn/user/958429870696856)

[蒙面大虾![lv-2](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/f597b88d22ce5370bd94495780459040.svg)](https://juejin.cn/user/958429870696856)

软件开发 @ 京东3年前

// 防抖，只执行最后一次
 function debounce (fn, wait) {
 var timer = null;
 return () => {
 if (timer) clearTimeout(timer);
 timer = setTimeout(() => fn.apply(this, Array.prototype.slice.call(arguments, 0)), wait);
 }
 },
 // 节流，每隔一段时间执行一次
 function throttle(fn, wait) {
 var timer = null;
 return () => {
 if (!timer) {
 timer = setTimeout(() => {
 fn.apply(this, Array.prototype.slice.call(arguments, 0));
 timer = null;
 }, wait);
 }
 }
 }

展开

7

回复

[![小丸子8292的头像](https://p26-passport.byteacctimg.com/img/user-avatar/114d76e029099936e4c5c2fc8457a6d2~300x300.image)](https://juejin.cn/user/4248168660469479)

[小丸子8292](https://juejin.cn/user/4248168660469479)

前端开发3年前

CDN 的原理是尽可能的在各个地方分布机房缓存数据

点赞

回复

[![夏忆的头像](https://p26-passport.byteacctimg.com/img/user-avatar/e5b67c6a429d4ffcc668025a6c6d7882~300x300.image)](https://juejin.cn/user/2172290705408455)

[夏忆](https://juejin.cn/user/2172290705408455)

前端3年前

我也感觉防抖跟节流实现功能差不多

点赞

6

[![img](https://p3-passport.byteacctimg.com/img/user-avatar/0b341256b30a5c1cc1126a89ba0f058e~300x300.image)](https://juejin.cn/user/676954893988680)

[MingYuan![lv-2](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/f597b88d22ce5370bd94495780459040.svg)](https://juejin.cn/user/676954893988680)

3年前

[![img](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/3f843e8626a3844c624fb596dddd9674.svg)juejin.im](https://juejin.im/post/5b8de829f265da43623c4261)

点赞

回复

[![img](https://p3-passport.byteacctimg.com/img/user-avatar/370197dea9a720799a3d94cc3005db87~300x300.image)](https://juejin.cn/user/3737995263096232)

[墨空![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/3737995263096232)

3年前

自己写写，看看效果不就懂了

点赞

回复

查看更多回复

[![JasonXiaoSpace的头像](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/mirror-assets/168e09c02889ebc2ba4~tplv-t2oaga2asx-no-mark:100:100:100:100.awebp)](https://juejin.cn/user/1961184475223645)

[JasonXiaoSpace](https://juejin.cn/user/1961184475223645)

17zuoye3年前

节流和防抖 感觉本质一样 都是避免某个短时间内的重复行为 我哪理解错了？

1

3

[![img](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/4/26/171b533d25770887~tplv-t2oaga2asx-no-mark:24:24:24:24.awebp)](https://juejin.cn/user/448256474611885)

[马克龙![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/448256474611885)

3年前

搜索引擎的搜索建议就是防抖。

点赞

回复

[![img](https://p26-passport.byteacctimg.com/img/user-avatar/afeb29b111f14025a93d67d7606d16fc~300x300.image)](https://juejin.cn/user/2101921962015847)

[宫商角徵羽![lv-2](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/f597b88d22ce5370bd94495780459040.svg)](https://juejin.cn/user/2101921962015847)

3年前

个人理解：节流=>用户工作时，我工作一段时间了，休息一会儿再接着工作(一段时间内只触发一次，用户动作不停，会间断的多次触发)；
防抖：用户不工作一段时间了，我开始工作了(间隔一段时间才触发一次，用户动作不停就一直不触发)

点赞

回复

查看更多回复

[![幻灵尔依的头像](https://p26-passport.byteacctimg.com/img/user-avatar/a052bf742cfed84db2732a4c9190fa6a~300x300.image)](https://juejin.cn/user/2101921963311303)

[幻灵尔依![lv-4](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/2c3fafd535a0625b44a5a57f9f536d77.svg)](https://juejin.cn/user/2101921963311303)

临时工 @ BUG搬运公司3年前

防抖不是一般在接口调成功之后再让点击的吗？

点赞

回复

[![好嗨呦的头像](https://p6-passport.byteacctimg.com/img/user-avatar/b6260c5f80f229dd8a4bfd6ef9f8ce1d~300x300.image)](https://juejin.cn/user/289926800214845)

[好嗨呦](https://juejin.cn/user/289926800214845)

web前端开发3年前

按钮点击防抖，加上去 之后好像没有作用哦

点赞

1

[![img](https://p6-passport.byteacctimg.com/img/user-avatar/b6260c5f80f229dd8a4bfd6ef9f8ce1d~300x300.image)](https://juejin.cn/user/289926800214845)

[好嗨呦](https://juejin.cn/user/289926800214845)

3年前

可以了，发现我是调用错了![😂](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/asset/twemoji/2.6.0/svg/1f602.svg~tplv-t2oaga2asx-image.image)

点赞

回复

[![rocky191的头像](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2017/12/7/16030548a8f02132~tplv-t2oaga2asx-no-mark:100:100:100:100.awebp)](https://juejin.cn/user/993614240163630)

[rocky191![lv-3](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/e108c685147dfe1fb03d4a37257fb417.svg)](https://juejin.cn/user/993614240163630)

前端小菜鸟 @ 创业公司3年前

性能优化的路无尽，极致的压榨性能，越快越好