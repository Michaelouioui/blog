# å®ç°å°å‹æ‰“åŒ…å·¥å…·

åŸæœ¬å°å†Œè®¡åˆ’ä¸­æ˜¯æ²¡æœ‰è¿™ä¸€ç« èŠ‚çš„ï¼ŒWebpack å·¥ä½œåŸç†åº”è¯¥æ˜¯ä¸Šä¸€ç« èŠ‚åŒ…å«çš„å†…å®¹ã€‚ä½†æ˜¯è€ƒè™‘åˆ°æ—¢ç„¶è®²åˆ°å·¥ä½œåŸç†ï¼Œå¿…ç„¶éœ€è¦è®²è§£æºç ï¼Œä½†æ˜¯ Webpack çš„æºç å¾ˆéš¾è¯»ï¼Œä¸ç»“åˆæºç å¹²å·´å·´è®²åŸç†åˆæ²¡æœ‰ä»€ä¹ˆä»·å€¼ã€‚æ‰€ä»¥åœ¨è¿™ä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘å°†ä¼šå¸¦å¤§å®¶æ¥å®ç°ä¸€ä¸ªå‡ åè¡Œçš„è¿·ä½ æ‰“åŒ…å·¥å…·ï¼Œè¯¥å·¥å…·å¯ä»¥å®ç°ä»¥ä¸‹ä¸¤ä¸ªåŠŸèƒ½

- å°† ES6 è½¬æ¢ä¸º ES5
- æ”¯æŒåœ¨ JS æ–‡ä»¶ä¸­ `import` CSS æ–‡ä»¶

é€šè¿‡è¿™ä¸ªå·¥å…·çš„å®ç°ï¼Œå¤§å®¶å¯ä»¥ç†è§£åˆ°æ‰“åŒ…å·¥å…·çš„**åŸç†**åˆ°åº•æ˜¯ä»€ä¹ˆã€‚

## å®ç°

å› ä¸ºæ¶‰åŠåˆ° ES6 è½¬ ES5ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦å®‰è£…ä¸€äº› Babel ç›¸å…³çš„å·¥å…·

```
yarn add babylon babel-traverse babel-core babel-preset-env  
```

æ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿™äº›å·¥å…·å¼•å…¥æ–‡ä»¶ä¸­

```
const fs = require('fs')
const path = require('path')
const babylon = require('babylon')
const traverse = require('babel-traverse').default
const { transformFromAst } = require('babel-core')
```

é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥å®ç°å¦‚ä½•ä½¿ç”¨ Babel è½¬æ¢ä»£ç 

```
function readCode(filePath) {
  // è¯»å–æ–‡ä»¶å†…å®¹
  const content = fs.readFileSync(filePath, 'utf-8')
  // ç”Ÿæˆ AST
  const ast = babylon.parse(content, {
    sourceType: 'module'
  })
  // å¯»æ‰¾å½“å‰æ–‡ä»¶çš„ä¾èµ–å…³ç³»
  const dependencies = []
  traverse(ast, {
    ImportDeclaration: ({ node }) => {
      dependencies.push(node.source.value)
    }
  })
  // é€šè¿‡ AST å°†ä»£ç è½¬ä¸º ES5
  const { code } = transformFromAst(ast, null, {
    presets: ['env']
  })
  return {
    filePath,
    dependencies,
    code
  }
}
```

- é¦–å…ˆæˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶è·¯å¾„å‚æ•°ï¼Œç„¶åé€šè¿‡ `fs` å°†æ–‡ä»¶ä¸­çš„å†…å®¹è¯»å–å‡ºæ¥
- æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ `babylon` è§£æä»£ç è·å– ASTï¼Œç›®çš„æ˜¯ä¸ºäº†åˆ†æä»£ç ä¸­æ˜¯å¦è¿˜å¼•å…¥äº†åˆ«çš„æ–‡ä»¶
- é€šè¿‡ `dependencies` æ¥å­˜å‚¨æ–‡ä»¶ä¸­çš„ä¾èµ–ï¼Œç„¶åå†å°† AST è½¬æ¢ä¸º ES5 ä»£ç 
- æœ€åå‡½æ•°è¿”å›äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­åŒ…å«äº†å½“å‰æ–‡ä»¶è·¯å¾„ã€å½“å‰æ–‡ä»¶ä¾èµ–å’Œå½“å‰æ–‡ä»¶è½¬æ¢åçš„ä»£ç 

æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½æœ‰ä»¥ä¸‹å‡ ç‚¹

- è°ƒç”¨ `readCode` å‡½æ•°ï¼Œä¼ å…¥å…¥å£æ–‡ä»¶
- åˆ†æå…¥å£æ–‡ä»¶çš„ä¾èµ–
- è¯†åˆ« JS å’Œ CSS æ–‡ä»¶

```
function getDependencies(entry) {
  // è¯»å–å…¥å£æ–‡ä»¶
  const entryObject = readCode(entry)
  const dependencies = [entryObject]
  // éå†æ‰€æœ‰æ–‡ä»¶ä¾èµ–å…³ç³»
  for (const asset of dependencies) {
    // è·å¾—æ–‡ä»¶ç›®å½•
    const dirname = path.dirname(asset.filePath)
    // éå†å½“å‰æ–‡ä»¶ä¾èµ–å…³ç³»
    asset.dependencies.forEach(relativePath => {
      // è·å¾—ç»å¯¹è·¯å¾„
      const absolutePath = path.join(dirname, relativePath)
      // CSS æ–‡ä»¶é€»è¾‘å°±æ˜¯å°†ä»£ç æ’å…¥åˆ° `style` æ ‡ç­¾ä¸­
      if (/\.css$/.test(absolutePath)) {
        const content = fs.readFileSync(absolutePath, 'utf-8')
        const code = `
          const style = document.createElement('style')
          style.innerText = ${JSON.stringify(content).replace(/\\r\\n/g, '')}
          document.head.appendChild(style)
        `
        dependencies.push({
          filePath: absolutePath,
          relativePath,
          dependencies: [],
          code
        })
      } else {
        // JS ä»£ç éœ€è¦ç»§ç»­æŸ¥æ‰¾æ˜¯å¦æœ‰ä¾èµ–å…³ç³»
        const child = readCode(absolutePath)
        child.relativePath = relativePath
        dependencies.push(child)
      }
    })
  }
  return dependencies
}
```

- é¦–å…ˆæˆ‘ä»¬è¯»å–å…¥å£æ–‡ä»¶ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„çš„ç›®çš„æ˜¯å­˜å‚¨ä»£ç ä¸­æ¶‰åŠåˆ°çš„æ‰€æœ‰æ–‡ä»¶
- æ¥ä¸‹æ¥æˆ‘ä»¬éå†è¿™ä¸ªæ•°ç»„ï¼Œä¸€å¼€å§‹è¿™ä¸ªæ•°ç»„ä¸­åªæœ‰å…¥å£æ–‡ä»¶ï¼Œåœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå…¥å£æ–‡ä»¶æœ‰ä¾èµ–å…¶ä»–çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šè¢« `push` åˆ°è¿™ä¸ªæ•°ç»„ä¸­
- åœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å…ˆè·å¾—è¯¥æ–‡ä»¶å¯¹åº”çš„ç›®å½•ï¼Œç„¶åéå†å½“å‰æ–‡ä»¶çš„ä¾èµ–å…³ç³»
- åœ¨éå†å½“å‰æ–‡ä»¶ä¾èµ–å…³ç³»çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆç”Ÿæˆä¾èµ–æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œç„¶ååˆ¤æ–­å½“å‰æ–‡ä»¶æ˜¯ CSS æ–‡ä»¶è¿˜æ˜¯ JS æ–‡ä»¶
  - å¦‚æœæ˜¯ CSS æ–‡ä»¶çš„è¯ï¼Œæˆ‘ä»¬å°±ä¸èƒ½ç”¨ Babel å»ç¼–è¯‘äº†ï¼Œåªéœ€è¦è¯»å– CSS æ–‡ä»¶ä¸­çš„ä»£ç ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª `style` æ ‡ç­¾ï¼Œå°†ä»£ç æ’å…¥è¿›æ ‡ç­¾å¹¶ä¸”æ”¾å…¥ `head` ä¸­å³å¯
  - å¦‚æœæ˜¯ JS æ–‡ä»¶çš„è¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ†æ JS æ–‡ä»¶æ˜¯å¦è¿˜æœ‰åˆ«çš„ä¾èµ–å…³ç³»
  - æœ€åå°†è¯»å–æ–‡ä»¶åçš„å¯¹è±¡ `push` è¿›æ•°ç»„ä¸­

ç°åœ¨æˆ‘ä»¬å·²ç»è·å–åˆ°äº†æ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®ç°æ‰“åŒ…çš„åŠŸèƒ½äº†

```
function bundle(dependencies, entry) {
  let modules = ''
  // æ„å»ºå‡½æ•°å‚æ•°ï¼Œç”Ÿæˆçš„ç»“æ„ä¸º
  // { './entry.js': function(module, exports, require) { ä»£ç  } }
  dependencies.forEach(dep => {
    const filePath = dep.relativePath || entry
    modules += `'${filePath}': (
      function (module, exports, require) { ${dep.code} }
    ),`
  })
  // æ„å»º require å‡½æ•°ï¼Œç›®çš„æ˜¯ä¸ºäº†è·å–æ¨¡å—æš´éœ²å‡ºæ¥çš„å†…å®¹
  const result = `
    (function(modules) {
      function require(id) {
        const module = { exports : {} }
        modules[id](module, module.exports, require)
        return module.exports
      }
      require('${entry}')
    })({${modules}})
  `
  // å½“ç”Ÿæˆçš„å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ä¸­
  fs.writeFileSync('./bundle.js', result)
}
```

è¿™æ®µä»£ç éœ€è¦ç»“åˆç€ Babel è½¬æ¢åçš„ä»£ç æ¥çœ‹ï¼Œè¿™æ ·å¤§å®¶å°±èƒ½ç†è§£ä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·å†™äº†

```
// entry.js
var _a = require('./a.js')
var _a2 = _interopRequireDefault(_a)
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj }
}
console.log(_a2.default)
// a.js
Object.defineProperty(exports, '__esModule', {
    value: true
})
var a = 1
exports.default = a
```

Babel å°†æˆ‘ä»¬ ES6 çš„æ¨¡å—åŒ–ä»£ç è½¬æ¢ä¸ºäº† CommonJSï¼ˆå¦‚æœä½ ä¸ç†Ÿæ‚‰ CommonJS çš„è¯ï¼Œå¯ä»¥é˜…è¯»è¿™ä¸€ç« èŠ‚ä¸­å…³äº [æ¨¡å—åŒ–çš„çŸ¥è¯†ç‚¹](https://juejin.cn/book/6844733763675488269/section/6844733763759374344)ï¼‰ çš„ä»£ç ï¼Œä½†æ˜¯æµè§ˆå™¨æ˜¯ä¸æ”¯æŒ CommonJS çš„ï¼Œæ‰€ä»¥å¦‚æœè¿™æ®µä»£ç éœ€è¦åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹è¿è¡Œçš„è¯ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å®ç° CommonJS ç›¸å…³çš„ä»£ç ï¼Œè¿™å°±æ˜¯ `bundle` å‡½æ•°åšçš„å¤§éƒ¨åˆ†äº‹æƒ…ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥é€è¡Œè§£æ `bundle` å‡½æ•°

- é¦–å…ˆéå†æ‰€æœ‰ä¾èµ–æ–‡ä»¶ï¼Œæ„å»ºå‡ºä¸€ä¸ªå‡½æ•°å‚æ•°å¯¹è±¡

- å¯¹è±¡çš„å±æ€§å°±æ˜¯å½“å‰æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œå±æ€§å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°ä½“æ˜¯å½“å‰æ–‡ä»¶ä¸‹çš„ä»£ç ï¼Œå‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°

   

  ```
  module
  ```

  ã€

  ```
  exports
  ```

  ã€

   

  ```
  require
  ```

  - `module` å‚æ•°å¯¹åº” CommonJS ä¸­çš„ `module`
  - `exports` å‚æ•°å¯¹åº” CommonJS ä¸­çš„ `module.export`
  - `require` å‚æ•°å¯¹åº”æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ `require` å‡½æ•°

- æ¥ä¸‹æ¥å°±æ˜¯æ„é€ ä¸€ä¸ªä½¿ç”¨å‚æ•°çš„å‡½æ•°äº†ï¼Œå‡½æ•°åšçš„äº‹æƒ…å¾ˆç®€å•ï¼Œå°±æ˜¯å†…éƒ¨åˆ›å»ºä¸€ä¸ª `require` å‡½æ•°ï¼Œç„¶åè°ƒç”¨ `require(entry)`ï¼Œä¹Ÿå°±æ˜¯ `require('./entry.js')`ï¼Œè¿™æ ·å°±ä¼šä»å‡½æ•°å‚æ•°ä¸­æ‰¾åˆ° `./entry.js` å¯¹åº”çš„å‡½æ•°å¹¶æ‰§è¡Œï¼Œæœ€åå°†å¯¼å‡ºçš„å†…å®¹é€šè¿‡ `module.export` çš„æ–¹å¼è®©å¤–éƒ¨è·å–åˆ°

- æœ€åå†å°†æ‰“åŒ…å‡ºæ¥çš„å†…å®¹å†™å…¥åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­

å¦‚æœä½ å¯¹äºä¸Šé¢çš„å®ç°è¿˜æœ‰ç–‘æƒ‘çš„è¯ï¼Œå¯ä»¥é˜…è¯»ä¸‹æ‰“åŒ…åçš„éƒ¨åˆ†ç®€åŒ–ä»£ç 

```
;(function(modules) {
  function require(id) {
    // æ„é€ ä¸€ä¸ª CommonJS å¯¼å‡ºä»£ç 
    const module = { exports: {} }
    // å»å‚æ•°ä¸­è·å–æ–‡ä»¶å¯¹åº”çš„å‡½æ•°å¹¶æ‰§è¡Œ
    modules[id](module, module.exports, require)
    return module.exports
  }
  require('./entry.js')
})({
  './entry.js': function(module, exports, require) {
    // è¿™é‡Œç»§ç»­é€šè¿‡æ„é€ çš„ require å»æ‰¾åˆ° a.js æ–‡ä»¶å¯¹åº”çš„å‡½æ•°
    var _a = require('./a.js')
    console.log(_a2.default)
  },
  './a.js': function(module, exports, require) {
    var a = 1
    // å°† require å‡½æ•°ä¸­çš„å˜é‡ module å˜æˆäº†è¿™æ ·çš„ç»“æ„
    // module.exports = 1
    // è¿™æ ·å°±èƒ½åœ¨å¤–éƒ¨å–åˆ°å¯¼å‡ºçš„å†…å®¹äº†
    exports.default = a
  }
  // çœç•¥
})
```

## å°ç»“

è™½ç„¶å®ç°è¿™ä¸ªå·¥å…·åªå†™äº†ä¸åˆ° 100 è¡Œçš„ä»£ç ï¼Œä½†æ˜¯æ‰“åŒ…å·¥å…·çš„æ ¸å¿ƒåŸç†å°±æ˜¯è¿™äº›äº†

1. æ‰¾å‡ºå…¥å£æ–‡ä»¶æ‰€æœ‰çš„ä¾èµ–å…³ç³»
2. ç„¶åé€šè¿‡æ„å»º CommonJS ä»£ç æ¥è·å– `exports` å¯¼å‡ºçš„å†…å®¹

å¦‚æœå¤§å®¶å¯¹äºè¿™ä¸ªç« èŠ‚çš„å†…å®¹å­˜åœ¨ç–‘é—®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸æˆ‘äº’åŠ¨ã€‚

ç•™è¨€

![img](https://p9-passport.byteacctimg.com/img/user-avatar/5e41ee1c076d80557fa78839ed4c71c7~300x300.image)

å‘è¡¨è¯„è®º

å…¨éƒ¨è¯„è®ºï¼ˆ37ï¼‰

[![å´”å´”å´”çš„å¤´åƒ](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/958429870174382)

[å´”å´”å´”![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/958429870174382)

å‰ç«¯3æœˆå‰

æœ‰ç‚¹![ğŸ‘](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/asset/twemoji/2.6.0/svg/1f44d.svg~tplv-t2oaga2asx-image.image)ä¹Ÿæœ‰ç‚¹éš¾![[æ³ªå¥”]](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/img/jj_emoji_85.43ad2fc.png)

ç‚¹èµ

å›å¤

[![Lynnicçš„å¤´åƒ](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/4424090522490967)

[Lynnic](https://juejin.cn/user/4424090522490967)

1å¹´å‰

è€Œä¸”ä¸ä¼šæœ‰å¾ªç¯å¼•ç”¨çš„é—®é¢˜å—ï¼Ÿ

ç‚¹èµ

å›å¤

[![Sinosaurusçš„å¤´åƒ](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/905653310992782)

[Sinosaurus![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/905653310992782)

å‰ç«¯æ‹–æ²¹ç“¶ @ ç©ºç©ºå¦‚ä¹Ÿ1å¹´å‰

ç†è§£çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ¸…æ¥šçŸ¥é“å“ªäº›æ˜¯è¾…åŠ©å‡½æ•°ç”¨äºç”Ÿæˆæ–‡ä»¶çš„ï¼Œå“ªäº›æ˜¯ä¼šå­˜åœ¨ç”Ÿæˆçš„æ–‡ä»¶ä¸­çš„

ç‚¹èµ

å›å¤

[![Lynnicçš„å¤´åƒ](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/4424090522490967)

[Lynnic](https://juejin.cn/user/4424090522490967)

1å¹´å‰

_a2.default _a2æ ¹æœ¬å­˜åœ¨å•Š

1

1

[![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/817692381821128)

[çƒ­çˆ±å­¦ä¹ ![lv-2](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/f597b88d22ce5370bd94495780459040.svg)](https://juejin.cn/user/817692381821128)

1å¹´å‰

@yck,ä½ ç¬”è¯¯äº†

ç‚¹èµ

å›å¤

[![Kingä¸¶æœè‹¥çš„å¤´åƒ](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/3878732753016280)

[Kingä¸¶æœè‹¥![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/3878732753016280)

å‰ç«¯å·¥ç¨‹å¸ˆ2å¹´å‰

è¯»å®Œäº†å‘ç°ï¼Œæ•´ä¸ªæ ¸å¿ƒæ˜¯åœ¨å®ç°requireå‡½æ•°ä¸Šï¼Œå‰é¢æ‰€æœ‰çš„æ“ä½œéƒ½åœ¨ä¸ºè¿™ä¸ªå‡½æ•°æœåŠ¡

1

å›å¤

[![æ­£åœ¨åŠ è½½è¯·ç¨å€™çš„å¤´åƒ](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/2453765682895527)

[æ­£åœ¨åŠ è½½è¯·ç¨å€™![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/2453765682895527)

å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ @ ï¼Ÿï¼Ÿï¼Ÿ2å¹´å‰

è¿™ä¸ªæ¡ˆä¾‹çœŸçš„æœ‰äººè·‘è¿‡ä¹ˆâ€¦â€¦ä¸è¯´åˆ«çš„â€¦â€¦
modules += `'${filePath}': (
 function (module, exports, require) { ${dep.code} }
 ),`
è¿™é‡Œçš„ä¿©æ‹¬å·çœŸçš„ä¸ä¼šæŠ¥é”™ä¹ˆâ€¦â€¦â€¦â€¦â€¦â€¦
ä»£ç è·‘ä¸èµ·æ¥å•Šâ€¦â€¦è¿è¡ŒæŠ¥é”™ï¼Œå¹¶ä¸”ä¹Ÿè¯»ä¸åˆ°requireçš„æ–‡ä»¶å†…å®¹å•Šâ€¦â€¦

3

å›å¤

[![little123çš„å¤´åƒ](https://p6-passport.byteacctimg.com/img/user-avatar/cdbdc72ef9fdeecc71db7eeb89c69c07~300x300.image)](https://juejin.cn/user/2013961031258269)

[little123![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/2013961031258269)

2å¹´å‰

ç”¨relativePathåšæ–‡ä»¶æ¨¡å—çš„å”¯ä¸€æ ‡è¯†ï¼Œå®¹æ˜“å†²çª

ç‚¹èµ

å›å¤

[![little123çš„å¤´åƒ](https://p6-passport.byteacctimg.com/img/user-avatar/cdbdc72ef9fdeecc71db7eeb89c69c07~300x300.image)](https://juejin.cn/user/2013961031258269)

[little123![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/2013961031258269)

2å¹´å‰

åœ¨entry.jsæ–‡ä»¶ä¸­var _a = require('./a.js')ï¼Œ
åœ¨readCodeå‡½æ•°ä¸­
 ImportDeclaration: ({node}) => {
 //ä¾èµ–æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„
 dependencies.push(node.source.value)
 }ï¼Œ
è¿™é‡Œå¹¶ä¸èƒ½è¯†åˆ«åˆ°requireçš„æ ‡è¯†ï¼Œå¯¼è‡´./a.jsæ²¡æœ‰è¢«æ”¾åˆ°dependenciesä¸­ã€‚
å¦‚æœæ”¹æˆ import a from './a.js'åˆ™å¯ä»¥è¢«ä¾èµ–æ”¶é›†åˆ°

å±•å¼€

2

å›å¤

[![è¶…è¶…å°±æ˜¯æˆ‘69532çš„å¤´åƒ](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/3808364010408958)

[è¶…è¶…å°±æ˜¯æˆ‘69532](https://juejin.cn/user/3808364010408958)

3å¹´å‰

å¯¹æ•´ä¸ªæ‰“åŒ…è¿‡ç¨‹ç»ˆäºæœ‰äº†äº†è§£

ç‚¹èµ

å›å¤

[![funwtçš„å¤´åƒ](https://p26-passport.byteacctimg.com/img/mosaic-legacy/3795/3044413937~300x300.image)](https://juejin.cn/user/2383396937931607)

[funwt](https://juejin.cn/user/2383396937931607)

3å¹´å‰

getDependencieså‡½æ•°çš„const dependencies = [entryObject]è¿™ä¸€å¥æ˜¯ä¸æ˜¯é”™äº†ï¼Ÿ

ç‚¹èµ

1

[![img](https://p26-passport.byteacctimg.com/img/mosaic-legacy/3795/3044413937~300x300.image)](https://juejin.cn/user/2383396937931607)

[funwt](https://juejin.cn/user/2383396937931607)

3å¹´å‰

ä¸å¥½æ„æ€ï¼Œæ˜¯æˆ‘è‡ªå·±ç†è§£é”™äº†

ç‚¹èµ

å›å¤

[![èƒ–æ¬¡è¶…äººçš„å¤´åƒ](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/2963939079761342)

[èƒ–æ¬¡è¶…äºº![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/2963939079761342)

å‰ç«¯å¼€å‘3å¹´å‰

æœ‰ç‚¹éš¾

2

å›å¤

[![zy_chçš„å¤´åƒ](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/2963939079226200)

[zy_ch![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/2963939079226200)

FE @ ä¸œå“¥å…„å¼Ÿ3å¹´å‰

å—æ•™äº†ï¼Œä¹‹å‰æˆ‘ç”¨çš„æ­£åˆ™å’Œejsæ¥å®ç°çš„ï¼Œç”¨äº†transformFromAstæ–¹ä¾¿å¤šäº†

ç‚¹èµ

å›å¤

[![ä¸èººå¹³ä¸­çš„å¤´åƒ](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/1380642334995559)

[ä¸èººå¹³ä¸­![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/1380642334995559)

å‰ç«¯3å¹´å‰

æ„Ÿè°¢ä½œè€…ï¼Œå¯¹webpackæ‰“åŒ…æœ‰äº†æ›´æ¸…æ™°çš„æ€è·¯

ç‚¹èµ

å›å¤

[![å¤§åœŸè±†ä¸¶çš„å¤´åƒ](https://p9-passport.byteacctimg.com/img/user-avatar/eeac0a450e05fe74c358fe69af1ae417~300x300.image)](https://juejin.cn/user/3438928101908638)

[å¤§åœŸè±†ä¸¶](https://juejin.cn/user/3438928101908638)

3å¹´å‰

å¤ªéš¾äº†-.-

1

å›å¤

[![é£é›çš„å¤´åƒ](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/1/18/1685ea940dd7fe60~tplv-t2oaga2asx-no-mark:100:100:100:100.awebp)](https://juejin.cn/user/1151943916662814)

[é£é›](https://juejin.cn/user/1151943916662814)

å‰ç«¯èºä¸é’‰3å¹´å‰

å¤šçœ‹å‡ éï¼Œå¤šçœ‹å‡ é :sob:

ç‚¹èµ

å›å¤

[![JasonXiaoSpaceçš„å¤´åƒ](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/mirror-assets/168e09c02889ebc2ba4~tplv-t2oaga2asx-no-mark:100:100:100:100.awebp)](https://juejin.cn/user/1961184475223645)

[JasonXiaoSpace](https://juejin.cn/user/1961184475223645)

17zuoye3å¹´å‰

å¤ªç”Ÿæ¶©äº†ã€‚å’Œå›½å¤–çš„å®˜æ–¹æ–‡æ¡£æ¯”å¯è¯»æ€§å·®å¤ªè¿œ

2

3

[![img](https://p26-passport.byteacctimg.com/img/user-avatar/a386aa8db73c9678458ec34161472ca5~300x300.image)](https://juejin.cn/user/712139233840407)

[yck![lv-7](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/7a2d00014351211140dd9bc0ba3afd8c.svg)](https://juejin.cn/user/712139233840407)

ï¼ˆä½œè€…ï¼‰3å¹´å‰

å®˜æ–¹æ–‡æ¡£éƒ½å¼€å§‹æ•™æ€ä¹ˆå®ç°æ‰“åŒ…å·¥å…·äº†ï¼Ÿ

1

å›å¤

[![img](https://p6-passport.byteacctimg.com/img/user-avatar/fd7a4cfd0309ac1014f68faf0d724b87~300x300.image)](https://juejin.cn/user/3966693684289965)

[Mrlgm![lv-2](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/f597b88d22ce5370bd94495780459040.svg)](https://juejin.cn/user/3966693684289965)

3å¹´å‰

ç« å£å°±æ¥

1

å›å¤

æŸ¥çœ‹æ›´å¤šå›å¤

[![ZedCodingçš„å¤´åƒ](https://p9-passport.byteacctimg.com/img/user-avatar/5a7bc1423ba1db61723cc44924335708~300x300.image)](https://juejin.cn/user/3790771822532110)

[ZedCoding](https://juejin.cn/user/3790771822532110)

å‰ç«¯ @ æ­å·é«˜çº§åˆ‡å›¾å·¥ä½œå®¤3å¹´å‰

è¿™å¼ é˜…è¯»èµ·æ¥å¾ˆåƒåŠ›

ç‚¹èµ

å›å¤

[![å•Šæ¦®çš„å¤´åƒ](https://p9-passport.byteacctimg.com/img/user-avatar/f0edb4ad09859df7b58212e856bccbc9~300x300.image)](https://juejin.cn/user/870468940468654)

[å•Šæ¦®](https://juejin.cn/user/870468940468654)

å‰ç«¯å¼€å‘ @ midea3å¹´å‰

å¯¹è¿™æ–¹é¢çš„å‰ç«¯çŸ¥è¯†ä¸¥é‡æ¬ ç¼º

ç‚¹èµ

å›å¤

[![cplayerçš„å¤´åƒ](https://p6-passport.byteacctimg.com/img/user-avatar/cdc30009db4a22d69d782c6f870ca832~300x300.image)](https://juejin.cn/user/3139860939669965)

[cplayer](https://juejin.cn/user/3139860939669965)

3å¹´å‰

getDpendencieså‡½æ•°é‡Œé¢æ²¡æœ‰é€’å½’å»å¯»æ‰¾ä¾èµ–,æ€ä¹ˆä¼šæœ‰å½¢æˆä¾èµ–æ ‘.

ç‚¹èµ

2

[![img](https://p26-passport.byteacctimg.com/img/user-avatar/a386aa8db73c9678458ec34161472ca5~300x300.image)](https://juejin.cn/user/712139233840407)

[yck![lv-7](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/7a2d00014351211140dd9bc0ba3afd8c.svg)](https://juejin.cn/user/712139233840407)

ï¼ˆä½œè€…ï¼‰3å¹´å‰

è‡ªå·±è¯•è¯•ä¸å°±å¥½äº†

ç‚¹èµ

å›å¤

[![img](https://p9-passport.byteacctimg.com/img/user-avatar/6b653c04d8aaf992b330835785029eb8~300x300.image)](https://juejin.cn/user/3808364010408958)

[è¶…è¶…å°±æ˜¯æˆ‘69532](https://juejin.cn/user/3808364010408958)

3å¹´å‰

const dependencies = []
traverse(ast, {
ImportDeclaration: ({ node }) => {
dependencies.push(node.source.value)
}
})

ç‚¹èµ

å›å¤

[![ä¸€ç‚¹ç¬”è®°çš„å¤´åƒ](https://p26-passport.byteacctimg.com/img/user-avatar/dbf03eebdf6844b37a7158a585bd2dd6~300x300.image)](https://juejin.cn/user/2013961033090311)

[ä¸€ç‚¹ç¬”è®°![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/2013961033090311)

3å¹´å‰

è¿™ç« è¶…èµ!

ç‚¹èµ

å›å¤

æŸ¥çœ‹å…¨éƒ¨ 37 æ¡å›å¤