# 监控

前端监控一般分为三种，分别为页面埋点、性能监控以及异常监控。

这一章节我们将来学习这些监控相关的内容，但是基本不会涉及到代码，只是让大家了解下前端监控该用什么方式实现。毕竟大部分公司都只是使用到了第三方的监控工具，而不是选择自己造轮子。

## 页面埋点

页面埋点应该是大家最常写的监控了，一般起码会监控以下几个数据：

- PV / UV
- 停留时长
- 流量来源
- 用户交互

对于这几类统计，一般的实现思路大致可以分为两种，分别为手写埋点和无埋点的方式。

相信第一种方式也是大家最常用的方式，可以自主选择需要监控的数据然后在相应的地方写入代码。这种方式的灵活性很大，但是唯一的缺点就是工作量较大，每个需要监控的地方都得插入代码。

另一种无埋点的方式基本不需要开发者手写埋点了，而是统计所有的事件并且定时上报。这种方式虽然没有前一种方式繁琐了，但是因为统计的是所有事件，所以还需要后期过滤出需要的数据。

## 性能监控

性能监控可以很好的帮助开发者了解在各种真实环境下，页面的性能情况是如何的。

对于性能监控来说，我们可以直接使用浏览器自带的 [Performance API](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FPerformance) 来实现这个功能。

对于性能监控来说，其实我们只需要调用 `performance.getEntriesByType('navigation')` 这行代码就行了。对，你没看错，一行代码我们就可以获得页面中各种详细的性能相关信息。



![img](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/2/7/168c82d1976cc115~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp)



我们可以发现这行代码返回了一个数组，内部包含了相当多的信息，从数据开始在网络中传输到页面加载完成都提供了相应的数据。



![img](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/2/7/168c82e5cc721387~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp)



## 异常监控

对于异常监控来说，以下两种监控是必不可少的，分别是代码报错以及接口异常上报。

对于代码运行错误，通常的办法是使用 `window.onerror` 拦截报错。该方法能拦截到大部分的详细报错信息，但是也有例外

- 对于跨域的代码运行错误会显示 `Script error.` 对于这种情况我们需要给 `script` 标签添加 `crossorigin` 属性
- 对于某些浏览器可能不会显示调用栈信息，这种情况可以通过 `arguments.callee.caller` 来做栈递归

对于异步代码来说，可以使用 `catch` 的方式捕获错误。比如 `Promise` 可以直接使用 `catch` 函数，`async await` 可以使用 `try catch`。

但是要注意线上运行的代码都是压缩过的，需要在打包时生成 sourceMap 文件便于 debug。

对于捕获的错误需要上传给服务器，通常可以通过 `img` 标签的 `src` 发起一个请求。

另外接口异常就相对来说简单了，可以列举出出错的状态码。一旦出现此类的状态码就可以立即上报出错。接口异常上报可以让开发人员迅速知道有哪些接口出现了大面积的报错，以便迅速修复问题。

## 小结

这一章节内容虽然不多，但是这类监控的知识网上的资料确实不多，相信能给大家一个不错的思路。

留言

![img](https://p9-passport.byteacctimg.com/img/user-avatar/5e41ee1c076d80557fa78839ed4c71c7~300x300.image)

发表评论

全部评论（20）

[![内小子的头像](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/764915821838973)

[内小子![lv-2](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/f597b88d22ce5370bd94495780459040.svg)](https://juejin.cn/user/764915821838973)

前端2月前

setTImeout里面抛出异常怎么捕获

点赞

回复

[![breeze的头像](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/729731451068087)

[breeze](https://juejin.cn/user/729731451068087)

1年前

。。。挺敷衍的

4

1

[![img](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/1732486056147127)

[🐮圈🐏![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/1732486056147127)

10月前

想当敷衍，不是挺

2

回复

[![石头就是我54394的头像](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/4441682707489303)

[石头就是我54394](https://juejin.cn/user/4441682707489303)

1年前

没有demo的文章，看着不怎么高大上，反而感觉烂烂的

1

回复

[![CregskiN的头像](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/553809591949437)

[CregskiN![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/553809591949437)

前端学徒1年前

异常监控部分，是否有可能用ErrorBoundaries解决的呢？[![img](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/3f843e8626a3844c624fb596dddd9674.svg)zh-hans.reactjs.org](https://link.juejin.cn/?target=https%3A%2F%2Fzh-hans.reactjs.org%2Fdocs%2Ferror-boundaries.html)

点赞

回复

[![页面工具人的头像](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC)](https://juejin.cn/user/1116759545093543)

[页面工具人](https://juejin.cn/user/1116759545093543)

页面仔 @ 未知2年前

有点短，怪不得阅读时间那么短。要是被问，哑口无言。

3

回复

[![console_man的头像](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2017/6/27/df28adb63d517eec43a8982f3958b919~tplv-t2oaga2asx-no-mark:100:100:100:100.awebp)](https://juejin.cn/user/1451011077317133)

[console_man](https://juejin.cn/user/1451011077317133)

Web前端2年前

期待讲下无埋点内容

点赞

回复

[![砖用冰西瓜的头像](https://p26-passport.byteacctimg.com/img/user-avatar/dee36188b78703b831bb042a0b17b593~300x300.image)](https://juejin.cn/user/1714893869549031)

[砖用冰西瓜![lv-3](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/e108c685147dfe1fb03d4a37257fb417.svg)](https://juejin.cn/user/1714893869549031)

3年前

监控分类里面的“页面埋点”跟后面的两个不是同一个类型的东西，后面两个是从监控的需求，“页面埋点”是实践的一种，“页面埋点”也可以用来做性能监控。个人认为应该把“页面埋点”换成“用户行为监控”。

点赞

回复

[![wei的头像](https://p3-passport.byteacctimg.com/img/user-avatar/0099cafc181fbf9ee0c1ff7319ead7a1~300x300.image)](https://juejin.cn/user/2629687541775512)

[wei](https://juejin.cn/user/2629687541775512)

fe dev3年前

这属于赶进度啊。。。

17

2

[![img](https://p6-passport.byteacctimg.com/img/user-avatar/fab436d77a6a35c26a96551f96a8e635~300x300.image)](https://juejin.cn/user/2049145404929421)

[千百度海![lv-1](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/636691cd590f92898cfcda37357472b8.svg)](https://juejin.cn/user/2049145404929421)

2年前

在过年的时候写的，有那么一丢丢赶进度的感觉

点赞

回复

[![img](https://p26-passport.byteacctimg.com/img/user-avatar/98e4b75bbc6837f079831028a3d78c0f~300x300.image)](https://juejin.cn/user/4441682707489303)

[石头就是我54394](https://juejin.cn/user/4441682707489303)

1年前

写的什么啊，退钱了

1

回复

[![suhangdev的头像](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/11/28/16eb069406e3a82e~tplv-t2oaga2asx-no-mark:100:100:100:100.awebp)](https://juejin.cn/user/4212984287858999)

[suhangdev![lv-2](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/f597b88d22ce5370bd94495780459040.svg)](https://juejin.cn/user/4212984287858999)

Node @ Ant3年前

能不能分享下前端无埋点方案的实现思路

1

回复

[![PerCy64890的头像](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/mirror-assets/168e0979ec3a5725d30~tplv-t2oaga2asx-no-mark:100:100:100:100.awebp)](https://juejin.cn/user/4107431172389048)

[PerCy64890](https://juejin.cn/user/4107431172389048)

3年前

没看够啊，这里内容不够仔细，只是知道个大概

点赞

回复

[![zexiplus的头像](https://p9-passport.byteacctimg.com/img/user-avatar/33af61b301919da939e6122af78d1521~300x300.image)](https://juejin.cn/user/3227821869640990)

[zexiplus](https://juejin.cn/user/3227821869640990)

web前端 @ Coding3年前

越到后面就越想大纲， 其实知识点很多， 但需要自己搜集一下

1

1

[![img](https://p9-passport.byteacctimg.com/img/mosaic-legacy/3796/2975850990~300x300.image)](https://juejin.cn/user/1785262616095726)

[Bin_zhu](https://juejin.cn/user/1785262616095726)

3年前

的确大纲

点赞

回复

[![MingYuan的头像](https://p3-passport.byteacctimg.com/img/user-avatar/0b341256b30a5c1cc1126a89ba0f058e~300x300.image)](https://juejin.cn/user/676954893988680)

[MingYuan![lv-2](https://lf3-cdn-tos.bytescm.com/obj/static/xitu_juejin_web/f597b88d22ce5370bd94495780459040.svg)](https://juejin.cn/user/676954893988680)

公众号：一只前端3年前

哇 到这都没人了么

点赞

回复

[![566的头像](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/mirror-assets/168e097d56e180f4615~tplv-t2oaga2asx-no-mark:100:100:100:100.awebp)](https://juejin.cn/user/448256475408008)

[566](https://juejin.cn/user/448256475408008)

3年前

这里的知识点也太少了吧

点赞

回复

[![crackedlove的头像](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/11/26/1674dfb5865d5694~tplv-t2oaga2asx-no-mark:100:100:100:100.awebp)](https://juejin.cn/user/2225067265633431)

[crackedlove](https://juejin.cn/user/2225067265633431)

前端攻城狮3年前

怎么没人？