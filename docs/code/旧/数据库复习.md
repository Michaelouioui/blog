## ch1

#### 文件管理系统存在的局限

- 数据冗余与非一致性
- 程序依赖于数据
- 数据孤立
- 完整性问题
- 更新的原子性保证问题
- 安全性问题

#### 数据库定义

数据库是长期存储在计算机内有组织的、大量的、相关联的、可共享的数据集合

#### 数据和信息的区别

- 数据是信息的符号表示或称为载体；信息是数据的内涵，是对数据语义的解释
- 数据表示了信息，而信息只有用过数据形式才能被计算机理解和接受

#### DBMS

##### 性质

- 安全性
- 完整性
- 并发控制
- 恢复
- 数据字典

他为用户提供一个可以方便的、有效的存取数据库信息的环境

#### 用户对数据库的操作

- 数据库定义
- 数据库操纵
- 数据库控制
- 数据库维护

#### 数据库方法的特点

- 数据抽象
   - 提供高层、概念的数据表示
   - 隐藏存储细节
   - 数据独立性
- 可靠
   - 保证完整性约束
   - 保证数据一致性
- 高效
   - 减少冗余
   - 通过优化和使用基于数据值的访问方法来增强查询的性能
   - 通过并发提高效率

### 数据库系统三层结构

#### 特点

数据库系统的体系结构收运行数据库的底层计算机系统的影响

#### 目标

- 改变存储结构而不影响用户视图
- 物理存储的改变不影响数据库内部结构
- 概念结构的改变不应影响所有用户

#### 三层结构

- 外部层
   - 用户视图
   - 某一用户能够看到与处理的数据
- 概念层
   - 总体视图
   - 从全局角度理解/管理的数据，含相应的关联约束
- 内部层
   - 存储在介质的数据，含存储路径、存储方式、索引方式等

### 数据模型

#### 概念

数据模型是描述数据、数据间联系、数据语义以及约束的工具集合，即模式的结构，是对模式本身结构的抽象，模式是对数据本身结构形式的抽象

##### 组成

- 数据结构
- 数据操纵
- 完整性约束

关系模型是数据库模型，具有数据模型的基本要素

## 关系型数据库

#### 关系模型的三个要素

- 基本结构
- 基本操作
- 完整性约束

#### 关系的形式化定义

- 属性：关系中命了名的列
- 域：属性允许取值的集合，属性值是不可分的

#### 关系实例

- 元组
- 度
- 基数
- ![image-20210625164248878](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210625164248878.png)

#### 规则

- 关系不重名
- 单元格不可再分
- 属性不重名
- 一个属性来自同一个域
- 元组不重复
- 列的顺序无所谓
- 行的顺序无所谓

#### 码

超码（SK）：能唯一表示一行的一个或多个属性

候选码（CK）：

主码（PK）：数据库设计者选中用来在同一关系中区分不同元组的候选码

备选码（AK）：剩下的码

外码（FK）：一个关系（参照关系）中的属性是另一关系（被参照关系）的主码，该属性为参照关系的外码

##### 主码的选择

- 整数优于长字符串
- 单属性主码优于复合主码

### 完整性约束

#### 三类完整性约束

- 实体完整性
   - 码值唯一
   - 主码的诸属性均不能为空值
- 参照完整性
   - 外码取参照码值或取空值
- 用户自定义

#### 操作

- 选择 $\sigma$![image-20210626081423435](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626081423435.png)
- 投影 $\prod$![image-20210626081412770](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626081412770.png)
- 并 $\bigcup$![image-20210626081358212](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626081358212.png)
- 集合差 -![image-20210626081347210](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626081347210.png)
- 笛卡尔积 $\times$![image-20210626081335127](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626081335127.png)
- 更名 $\rho$![image-20210626081447284](C:\Users\86135\docs\docs\code\image-20210626081447284.png)
- 交 $\bigcap$![image-20210626081552783](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626081552783.png)
- 自然连接 $\bowtie$![image-20210626081822680](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626081822680.png)
- 除 $\div$![image-20210626081844462](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626081844462.png)
- 赋值![image-20210626081932248](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626081932248.png)



## 关系型数据库

### 元组关系演算

#### 概念

关系演算是一种非过程化查询语言

是以数理逻辑中的为此演算为基础

按照为此变量的不同，可分为元组关系演算和域关系演算

- ​	元组变量——元组关系演算
- 域变量——域关系演算

#### 三种形式的原子公式

![image-20210626082542084](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626082542084.png)

![image-20210626082630727](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626082630727.png)

#### 元组关系演算表达式的安全性

不产生无限关系和无穷验证的运算被称为是安全的

## SQL

#### 概念

SQL语言是集DDL、DML和DCL于一体的数据库语言

DDL语句引导词：

- Create 建立
- Alter 修改
- Drop 撤销

DML语句引导词：

- Insert
- Delete
- Update
- Select

DCL语句引导词：

- Grant
- Revoke

#### 创建数据库

创建数据库

![image-20210626084837317](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626084837317.png)

创建表

![image-20210626084904091](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626084904091.png)

确定码

![image-20210626084931383](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626084931383.png)

![image-20210626085325001](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626085325001.png)

![image-20210626085337599](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626085337599.png)

![image-20210626085414831](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626085414831.png)





- group by
- having
- unique
- select...into
- compute

![image-20210626110634732](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626110634732.png)





## 	ch4

#### 联系

联系时多个实体之间的关联

联系集是一组相同类型的联系

#### 映射基数

一个实体通过一个联系集能同时关联的实体个数



参与实体集的PK构成联系集的超码







#### 数据保护

- 安全性
- 完整性
- 并发控制
- 数据库恢复

#### 事务

事务时用户定义的一个数据库操作序列，这些操作要么全做，要么全不做，是一个不可分割的工作单位

事务时恢复和并发控制的基本单位

#### 事务的ACID特性

- 原子性 Atomicity
   - 事务时数据库的逻辑工作单位
- 一致性 Consistency
   - 事务执行的结果必须是使数据库从一个一致性状态变到另一个一致性状态
   - 一致性状态：只包含成功事务提交的结果
   - 不一致状态：数据库中包含失败事务的结果
- 隔离性 Isolation
   - 对于并发执行而言，一个事务的执行不能被其他事务干扰
- 持续性 Durability
   - 一个事务一旦提交，他对数据库中数据的改变就应该是永久性的

#### 事务故障

整个事务在运行过程中由于种种原因未运行至正常终止点就夭折了

#### 事务故障的恢复

Undo 撤销事务

Rollback 强行回滚该事务

#### 系统故障

- 整个系统的正常运行突然被破坏
- 所有正在运行的事务都非正常终止
- 内存中数据库缓冲区的信息全部丢失
- 外部讯息不设备上的数据未受影响

#### 恢复操作的基本原理

利用存储在系统其他地方的冗余数据来重建数据库中已被破坏或不正确的那部分数据

##### 如何建立冗余数据

- 数据转储
- 登录日志文件

#### 转储

- 转储实质DBA将整个数据库复制到磁带或零i个磁盘上保存起来的过程
- 这些备用的数据文本称为后备副本或后援副本

#### 静态转储

![image-20210626164651000](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626164651000.png)

#### 动态转储

![image-20210626164705378](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626164705378.png)

#### 海量转储域增量转储

![image-20210626164727228](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626164727228.png)

#### 日志

日志文件是用来记录事务对数据库的封信操作的文件

格式分为：

- 以记录为单位的日志文件
- 以数据块为单位的日志文件

原则：

- 登记的次序严格按并行事务执行的时间次序
- 必须先写日志文件，后写数据库

### 恢复

#### 事务故障的恢复

事务故障：事务在运行至正常终止点前被中止

恢复方法：由恢复子系统应利用日志文件撤销（undo）此事务已对数据库进行的修改

回复步骤

1. 反向扫描文件日志，查找该事务的更新操作
2. 对该事务的更新操作执行逆操作。即将日志记录中更新前的值写入数据库
3. 继续反向扫描日志文件，查找该事务的其他更新操作，并作同样处理
4. 直至读到此事务的开始标记

#### 系统故障的恢复

系统故障的恢复由系统在重新启动时自动完成

#### 介质故障的恢复

1. 重装数据库
2. 重做已完成的事务

## 并发控制





#### 锁

- X锁 排他锁![image-20210626175447330](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626175447330.png)
- S锁 共享锁![image-20210626175457727](C:\Users\86135\AppData\Roaming\Typora\typora-user-images\image-20210626175457727.png)
- U锁 更新锁
- I锁 增量锁











































